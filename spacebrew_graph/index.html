<!DOCTYPE HTML>
<html>
	<head>
		<title>Spacebrew Graph</title>

		<meta charset="utf-8">
		<link rel="stylesheet" href="css/reset.css" type="text/css" media="screen" charset="utf-8" />
		<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
    <script type="text/javascript" src="js/jq.js"></script>
    <script type="text/javascript" src="js/smoothie.js"></script>
    <script type="text/javascript" src="js/sb.js"></script>

    <script type="text/javascript">

      // when page loads call the setup function to connect to spacebrew
      $(window).on("load",  setup );

      // variable that holds the spacebrew client object
      var sb;

      // variabls that hold the boolean and string values received via spacebrew
      var boolVal1, boolVal2, boolVal3;
      var currentMessage1, currentMessage2, currentMessage3;

      /**
       * setup Function that creates and configures the connection to the Spacebrew server.
       *          It is called when the page loads.
       */
      function setup (){
        // setup spacebrew!
        sb = new Spacebrew.Client();
        sb.description("This is a client which can be used to visualize various outputs from any other publishers.");

        // Override Spacebrew events - this is how you catch events coming from Spacebrew
        sb.onRangeMessage = onRangeMessage;
        sb.onStringMessage = onStringMessage;
        sb.onBooleanMessage = onBooleanMessage;

        // create the spacebrew subscription channels
        sb.addSubscribe("line1","range");
        sb.addSubscribe("line2","range");
        sb.addSubscribe("line3","range");
        sb.addSubscribe("bool1","boolean");
        sb.addSubscribe("bool2","boolean");
        sb.addSubscribe("bool3","boolean");
        sb.addSubscribe("string1","string");
        sb.addSubscribe("string2","string");
        sb.addSubscribe("string3","string");

        // connect to spacebrew
        sb.connect();
      }
            
      /**
       * onRangeMessage Function that is called whenever new spacebrew range messages are received.
       *          It accepts two parameters:
       * @param  {String} name    Holds name of the subscription feed channel
       * @param  {Integer} value  Holds value received from the subscription feed
       */
      function onRangeMessage( name, value ){
        // handle the messages from each subscription channel
        if (name == "line1") {
          console.log("received line1 message");
          line1.append(new Date().getTime(), value);  // append new data point to line
        }

        if (name == "line2") {
          console.log("received line2 message");
          line2.append(new Date().getTime(), value);  // append new data point to line
        }

        if (name == "line3") {
          console.log("received line3 message");
          line3.append(new Date().getTime(), value);  // append new data point to line
        }
      }

      /**
       * onStringMessage Function that is called whenever new spacebrew string messages are received.
       *          It accepts two parameters:
       * @param  {String} name    Holds name of the subscription feed channel
       * @param  {String} value   Holds text message received from the subscription feed
       */
      function onStringMessage( name, value ){
        // handle the messages from each subscription channel
        if (name == "string1") {
          console.log("received string1 message");
          currentMessage1 = value;  // set message 1 value
        }

        if (name == "string2") {
          console.log("received string2 message");
          currentMessage2 = value;  // set message 2 value
        }

        if (name == "string3") {
          console.log("received string3 message");
          currentMessage3 = value;  // set message 3 value
        }

        // load the new values to the browser
        $("#currentMessage").html("1: " + currentMessage1 + " <br/>2: " + currentMessage2 + " <br/>3: " + currentMessage3);

      }

      /**
       * onBooleanMessage Function that is called whenever new spacebrew boolean messages are received.
       *          It accepts two parameters:
       * @param  {String} name    Holds name of the subscription feed channel
       * @param  {Integer} value  Holds boolean received from the subscription feed
       */
      function onBooleanMessage( name, value ){
        // handle the messages from each subscription channel
        if (name == "bool1") {
            console.log("received bool1 message");
            boolVal1 = value;   // set boolean value 1
        }

         if (name == "bool2") {
            console.log("received bool2 message");
            boolVal2 = value;   // set boolean value 2
        }

         if (name == "bool1") {
            console.log("received bool1 message");
            boolVal3 = value;   // set boolean value 3
        }

        // load the new values to the browser
        $("#bools").html("1: " + boolVal1 + " 2: " + boolVal2 + " 3: " + boolVal3);
      }

    </script>
		<!-- MAIN -->
	</head>

	<body>
    <h4>Incoming Range Data:</h4>
		<canvas id="mycanvas" width="700" height="350"></canvas>

    <h4>Incoming Booleans:</h4>
    <div id="bools"> 1: undefined 2: undefined 3: undefined</div>

    <h4>Incoming Strings:</h4>
    <div id="currentMessage"> 1: <br/>2: <br/>3: </div>
  </body>
</html>

<script type="text/javascript">
  // GRAPHING STUFF

  // create the three different time series that graph the range inputs from spacebrew
  var line1 = new TimeSeries();
  var line2 = new TimeSeries();
  var line3 = new TimeSeries();

  // create the chart wher the time series will be graphed
  var smoothie = new SmoothieChart({  grid: { strokeStyle: 'rgb(211, 25, 150)', 
                                              fillStyle: 'rgb(112, 141, 145)', 
                                              lineWidth: 1, 
                                              millisPerLine: 250, 
                                              verticalSections: 6 
                                            } 
                                      });

  // add the time series to the graph
  smoothie.addTimeSeries(line1, { strokeStyle: 'rgb(211, 25, 150)', fillStyle: 'rgba(211, 25, 150, 0.4)', lineWidth: 3 });
  smoothie.addTimeSeries(line2, { strokeStyle: 'rgb(25, 221, 137)', fillStyle: 'rgba(25, 221, 137, 0.3)', lineWidth: 3 });
  smoothie.addTimeSeries(line3, { strokeStyle: 'rgb(8, 164, 153)', fillStyle: 'rgba(8, 164, 153, 0.3)', lineWidth: 3 });

  // add the graph to the canvas
  smoothie.streamTo(document.getElementById("mycanvas"), 1000);

</script>
